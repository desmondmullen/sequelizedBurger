<div><a href='/' class='heading-text'>
        <img class='icon' src='assets/img/black-bean-burger.png' width=220>
        <h1 class='heading heading-text'>Eat Da Burger!</h1>
    </a>
</div>
<div class='col-container'>
    <div class='left-side'>
        <section class='center'>
            <h2>Burgers that have been created</h2>
        </section>
        <ul>
            {{#with data as |data|}}
            {{#each data.burgers}}
            {{#unless devoured}}
            <li class='created-li'>
                <div class="dropdown">
                    {{burger_name}} &nbsp;<button onclick="myFunction()" class="dropbtn" id='brg-{{this.id}}'>Devour
                        this
                        burger!</button>
                    <div id="myDropdown" class="dropdown-content">
                        {{#each data.customers}}
                        <a href="#" class="dropdown-choice" id='cst-{{this.id}}'>{{customer_name}}</a>
                        {{/each}}
                        <a href="#"><input type="text" placeholder="Add your name..." id="addMyName"
                                onchange="addMyName()"></a>
                    </div>
                </div>
            </li>
            {{/unless}}
            {{#if last_one_devoured}}
            <li class='created-li'>
                <section class='last-one-devoured'>{{burger_name}}</section>
            </li>
            {{/if}}
            {{/each}}
        </ul>
    </div>
    <div class='middle'>
    </div>
    <div class='right-side'>
        <section class='center'>
            <h2>Hall of Fame<br>(Burgers that have been devoured)</h2>
        </section>
        <ul>
            {{#each data.burgers}}
            {{#if last_one_devoured}}
            <li class='devoured-li'>
                <section class='last-one-added'>{{burger_name}}</section>
            </li>
            {{else}}
            {{#if devoured}}
            <li class='devoured-li'>
                {{burger_name}}
            </li>
            {{/if}}
            {{/if}}
            {{/each}}
            {{/with}}
        </ul>
    </div>
</div>
<div class='add-a-burger'>
    <h2 class='add-a-burger-heading'>Add a Burger of your own!</h2>
    <form action='/' method='post'>
        Your name: <input type='text' name='your_name' autofocus size='35'> Burger name: <input type='text'
            name='burger_name' size='35'> <input class='button' type='submit' value='Submit'>
    </form>
</div>
<script>
    var targetId = '';
    $('.last-one-devoured').animate({ opacity: '0', 'margin-left': '+=20%' }, 1000);
    setTimeout(function () {
        $('.last-one-added').animate({ opacity: '1', 'margin-left': '+=20%' }, 1000);
    }, 600);
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }
    // Close the dropdown menu if the user clicks outside of it
    window.onclick = function (event) {
        if (event.target.matches('.dropbtn')) {
            targetId = (event.target.id).split('-')[1];
        }
        if (event.target.matches('.dropdown-choice')) {
            toggleDropdown();
            targetCustomerId = (event.target.id).split('-')[1];
            doAjaxCall(targetCustomerId, event.target.text);
        }
    };

    function doAjaxCall(customer_id, customer_name) {
        $.ajax({
            url: '/',
            type: 'PUT',
            data: {
                id: targetId,
                customer_id: customer_id,
                customer_name: customer_name
            },      //Data as js object
            success: function (result) {
                //console.log('sent ajax ' + targetId + ', ' + customerId + ', ' + customerName);
                document.open();
                document.write(result);
                document.close();
            }
        });
    };

    function toggleDropdown() {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
            }
        };
    };

    function addMyName() {
        toggleDropdown();
        doAjaxCall(null, document.getElementById("addMyName").value);
    };
</script>